---
title: "Introducing CaptainAgent for Adaptive Team Building"
authors:
  - LinxinS97
  - jialeliu
  - jieyuz2
tags: [LLM, GPT, AutoBuild]
---
![Illustration of how CaptainAgent build a team](img/overall.png)

**TL;DR**
- We introduce CaptainAgent, an agent equipped with the capability to adaptively assemble a team of agents through retrieval-selection-generation process to handle complex tasks via the [`nested chat`](https://ag2ai.github.io/ag2/docs/tutorial/conversation-patterns#nested-chats) conversation pattern in AG2.
- CaptainAgent supports all types of `ConversableAgents` implemented in Autogen.


# Introduction

Assembling a team of LLM agents is easy, but dynamically choosing the right agents into a group chat according to the task is hard. In this blog, we introduce **CaptainAgent**, an agent that can automatically build a team of agents to fulfill diverse, complex task requirements.
We design a two-step workflow for CaptainAgent to build a high quality team and solve the problem:
- (**Step 1**) CaptainAgent will first identify a subtask instructed by our prompt, list several roles needed for this subtask, and then create a team of agents accordingly by retrieval, selection, and generation. Each of these will be equipped with predefined tools retrieved from the tool library.
![Building workflow](img/build.png)
- (**Step 2**) this team of agents will attempt to solve the subtask via conversation with the free-form tool using. Once it's done, a reflector LLM will provide CaptainAgent with a reflection report for it to decide whether to adjust the team or subtask instruction or to terminate and output the results.
![Building workflow](img/chat.png)

We provide an agent library and a tool library for CaptainAgent to choose from when building the team. In the following section, we demonstrate how to use CaptainAgent.

# Using CaptainAgent
CaptainAgent can serve as a drop in replacement for the general AssistantAgent. To use CaptainAgent, we need to instantiate a CaptainAgent and the corresponding CaptainUserProxy, then initiate a chat. To do that we just need to configure to the settings of group chat instantiated by CaptainAgent.

```python
from autogen.agentchat.contrib.captain_agent import CaptainAgent

general_llm_config = {
    "temperature": 0,
    "config_list": autogen.config_list_from_json("OAI_CONFIG_LIST", filter_dict={"model": ["gpt-4-1106-preview"]}),
}

nested_mode_config = {
    "autobuild_init_config": {
        "config_file_or_env": "OAI_CONFIG_LIST",
        "builder_model": "gpt-4-1106-preview",
        "agent_model": "gpt-4-1106-preview",
    },
    # this is used to configure the autobuild building process
    "autobuild_build_config": {
        "default_llm_config": {"temperature": 1, "top_p": 0.95},
        "code_execution_config": {"timeout": 300, "work_dir": "groupchat", "last_n_messages": 1},
        "coding": True,
    },
    "group_chat_config": {"max_round": 15},
    "group_chat_llm_config": general_llm_config.copy(),
}

## build agents
captain_agent = CaptainAgent(
    name="captain_agent",
    llm_config=general_llm_config,
    nested_mode_config=nested_mode_config,
)
user_proxy = CaptainUserProxyAgent(
    name="user_proxy",
    code_execution_config={"use_docker": False},
)

query = 'Find the stock price of Microsoft in the past 1 year and plot a line chart to show the trend. Save the line chart as "microsoft_stock_price.png".'

result = captain_user_proxy.initiate_chat(captain_agent, message=query, max_turns=3)
```

# Further Reading
For a detailed description of how to configure the CaptainAgent, please refer to the document.

Please refer to our [paper](https://arxiv.org/pdf/2405.19425) for more details about CaptainAgent and the proposed new team-building paradigm: adaptive build.

If you find this blog useful, please consider citing:
```
@misc{song2024adaptiveinconversationteambuilding,
      title={Adaptive In-conversation Team Building for Language Model Agents},
      author={Linxin Song and Jiale Liu and Jieyu Zhang and Shaokun Zhang and Ao Luo and Shijian Wang and Qingyun Wu and Chi Wang},
      year={2024},
      eprint={2405.19425},
      archivePrefix={arXiv},
      primaryClass={cs.CL},
      url={https://arxiv.org/abs/2405.19425},
}
```
