```python
import json

from pydantic import BaseModel

from autogen import ConversableAgent, LLMConfig

# 1. Define our lesson plan structure, a lesson with a number of objectives
class LearningObjective(BaseModel):
    title: str
    description: str

class LessonPlan(BaseModel):
    title: str
    learning_objectives: list[LearningObjective]
    script: str

# 2. Add our lesson plan structure to the LLM configuration
llm_config = LLMConfig(config_list={
    "api_type": "openai",
    "model": "gpt-5-nano",
    "response_format": LessonPlan,
})

# 3. The agent's system message doesn't need any formatting instructions
system_message = '''You are a classroom lesson agent.
Given a topic, write a lesson plan for a fourth grade class.
'''

my_agent = ConversableAgent(
    name="lesson_agent",
    system_message=system_message,
    llm_config=llm_config,
)

# 4. Chat directly with our agent
response = my_agent.run(
    message="Let's learn about the solar system!",
    user_input=True,
    max_turns=1,
)

# 5. Iterate through the chat automatically with console output
response.process()

# 6. Get and print our lesson plan as a dict, accessed from the parsed content block
# Find the 'parsed' type GenericContent in the last message's content blocks
last_message_content = response.messages[-1]["content"]
parsed_block = next((block for block in last_message_content if getattr(block, "type", None) == "parsed"), None)

if parsed_block is not None:
    lesson_plan_dict = parsed_block.parsed
    print(json.dumps(lesson_plan_dict, indent=2))
else:
    print("No structured lesson plan found in the response.")
```