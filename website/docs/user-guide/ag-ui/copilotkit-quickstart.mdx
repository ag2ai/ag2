---
sidebarTitle: CopilotKit Quickstart
title: "CopilotKit UI Quickstart for AG-UI"
description: "Connect a React/Next.js CopilotKit UI to an AG2 AG-UI runtime endpoint."
---

This quickstart shows how to connect a CopilotKit React/Next.js UI to an AG2 backend endpoint that speaks AG-UI.

## What you'll build

- A streaming chat UI in Next.js
- Tool call rendering hooks for interactive UI actions
- Shared state synchronization between frontend and runtime payloads

## Prerequisites

- Python backend runtime with an AG-UI endpoint (for example, `/chat` from [AG-UI integration](./index.mdx))
- Node.js and a Next.js frontend
- CopilotKit + AG-UI client packages in your frontend:
  `@copilotkit/react-core`, `@copilotkit/react-ui`, `@copilotkit/runtime`, `@ag-ui/client`
- Backend model credentials (for example `OPENAI_API_KEY`) required by your AG2 agent
- If your backend is protected, an auth strategy (header/cookie/token) for runtime requests

## Quickstart

1. Start an AG-UI backend endpoint (example: `http://127.0.0.1:8000/chat`).
2. Create or open a Next.js app.
3. Install CopilotKit packages in the UI app.
4. Add a runtime route (`/api/copilotkit`) that forwards requests to your backend AG-UI endpoint.
5. Wrap your app with `CopilotKit` provider and render a chat UI component.

Runnable reference implementation: [AG2 CopilotKit starter](https://github.com/ag2ai/ag2-copilotkit-starter){.external-link target="_blank"}.

## Connect to the runtime URL

The runtime route below matches the current CopilotKit pattern used in their latest quickstarts.

```tsx title="ui/app/api/copilotkit/route.ts"
import {
  CopilotRuntime,
  ExperimentalEmptyAdapter,
  copilotRuntimeNextJSAppRouterEndpoint,
} from "@copilotkit/runtime";
import { HttpAgent } from "@ag-ui/client";
import { NextRequest } from "next/server";

const serviceAdapter = new ExperimentalEmptyAdapter();

const runtime = new CopilotRuntime({
  agents: {
    my_agent: new HttpAgent({ url: "http://127.0.0.1:8000/chat" }),
  },
});

export const POST = async (req: NextRequest) => {
  const { handleRequest } = copilotRuntimeNextJSAppRouterEndpoint({
    runtime,
    serviceAdapter,
    endpoint: "/api/copilotkit",
  });

  return handleRequest(req);
};
```

Provider wiring with runtime URL:

```tsx title="ui/app/layout.tsx"
import { CopilotKit } from "@copilotkit/react-core";
import "@copilotkit/react-ui/styles.css";

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <body>
        <CopilotKit agent="my_agent" runtimeUrl="/api/copilotkit" showDevConsole={false}>
          {children}
        </CopilotKit>
      </body>
    </html>
  );
}
```

If your backend enforces CORS/auth, configure those before starting the UI (details in Production notes).

## Chat UI

```tsx title="ui/app/page.tsx"
"use client";

import { CopilotSidebar } from "@copilotkit/react-ui";

export default function Home() {
  return (
    <main>
      <CopilotSidebar
        defaultOpen={true}
        labels={{
          title: "Support Assistant",
          initial: "Hi, I can help with billing and account questions.",
        }}
      />
    </main>
  );
}
```

## Tool UI rendering

```tsx title="ui/app/tool-rendering.tsx"
import { useFrontendTool } from "@copilotkit/react-core";

export function OrderStatusTool() {
  useFrontendTool({
    name: "show_order_status_card",
    description: "Render order status in the chat UI.",
    parameters: [
      { name: "orderId", type: "string", description: "Order identifier", required: true },
      { name: "status", type: "string", description: "Order status text", required: true },
    ],
    handler: async ({ orderId, status }) => ({ orderId, status }),
    render: ({ args }) => (
      <div>
        <strong>Order {args.orderId}</strong>
        <p>Status: {args.status}</p>
      </div>
    ),
  });

  return null;
}
```

Expected behavior: when AG2 emits a matching frontend tool call, CopilotKit renders this component inside the chat.

## Shared state

```tsx title="ui/app/shared-state.tsx"
import { useAgent } from "@copilotkit/react-core/v2";

type AgentState = {
  currency: "USD" | "EUR";
  locale: string;
};

export function SharedStateControls() {
  const { agent } = useAgent<AgentState>({
    agentId: "my_agent",
    initialState: { currency: "USD", locale: "en-US" },
  });

  const toggleCurrency = () => {
    const currency = agent.state.currency === "USD" ? "EUR" : "USD";
    agent.setState({ currency, locale: agent.state.locale });
  };

  return (
    <button onClick={toggleCurrency}>
      Currency: {agent.state.currency}
    </button>
  );
}
```

On the backend, AG2 receives frontend state in `RunAgentInput.state`; AG2 may emit new `STATE_SNAPSHOT` events after context changes.

## Expected output

After setup:

- The Next.js page shows a Copilot chat sidebar
- User messages stream token-by-token/segment-by-segment from the AG2 runtime
- Tool/action calls can render custom UI cards/components
- Shared-state changes in the UI are reflected in backend run state and subsequent responses

## Production notes

- CORS: allow your frontend origin on the AG-UI backend (`POST`, `OPTIONS`, auth headers).
- Auth: protect both `/api/copilotkit` and backend `/chat` (token/header/cookie); do not rely on client-only secrets.
- Deployment topology: keep frontend runtime route and AG-UI backend on trusted internal network paths where possible.
- Timeouts/retries: configure conservative client and server timeouts for long-running tool workflows and retry only idempotent requests.

## Troubleshooting

- CORS errors (`blocked by CORS policy`): check backend `Access-Control-Allow-Origin`, `Access-Control-Allow-Headers`, and preflight handling.
- No streaming output: verify backend response `Content-Type` is `text/event-stream` and that proxy layers do not buffer SSE.
- Tool UI not rendering: ensure emitted tool/action names match UI registration names exactly.
- Backend receives empty state: verify frontend is sending initial state and subsequent updates with each runtime request.

## Security considerations

Treat tool inputs and shared state as untrusted user-controlled data. Validate and authorize server-side before invoking privileged tools, and log tool execution with request identifiers for auditability.

## Version and compatibility notes

- AG2 side in this repo uses `ag2[ag-ui]` with `ag-ui-protocol>=0.1.10,<0.2` (`pyproject.toml`).
- CopilotKit examples on `main` currently use `CopilotRuntime` + `ExperimentalEmptyAdapter` + `copilotRuntimeNextJSAppRouterEndpoint` (from `@copilotkit/runtime`) and `HttpAgent` (from `@ag-ui/client`) for runtime-to-agent wiring.
