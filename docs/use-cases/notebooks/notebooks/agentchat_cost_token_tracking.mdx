---
custom_edit_url: https://github.com/ag2ai/ag2/edit/main/notebook/agentchat_cost_token_tracking.ipynb
description: cost calculation and consumption limits
source_notebook: /notebook/agentchat_cost_token_tracking.ipynb
tags:
- cost
- limits
title: Usage tracking and limits with AG2
---

<a href="https://colab.research.google.com/github/ag2ai/ag2/blob/main/notebook/agentchat_cost_token_tracking.ipynb" class="colab-badge" target="_blank"><img noZoom src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" /></a>
<a href="https://github.com/ag2ai/ag2/blob/main/notebook/agentchat_cost_token_tracking.ipynb" class="github-badge" target="_blank"><img noZoom src="https://img.shields.io/badge/Open%20on%20GitHub-grey?logo=github" alt="Open on GitHub" /></a>

## Setting Consumption Limits

AG2 provides several ways to set upper limits on chat consumption to control costs and prevent runaway conversations:

### 1. Token Limits

You can set maximum token limits in your LLM configuration:

```python
llm_config = {
    "config_list": config_list,
    "max_tokens": 1000,  # Maximum tokens per response
    "timeout": 600,
    "cache_seed": None
}
```

### 2. Conversation Turn Limits

Control the number of back-and-forth exchanges:

```python
assistant = AssistantAgent(
    "assistant",
    system_message="You are a helpful assistant.",
    llm_config=llm_config,
    max_consecutive_auto_reply=3  # Limit consecutive auto-replies
)

user_proxy = UserProxyAgent(
    "user_proxy",
    human_input_mode="NEVER",
    max_consecutive_auto_reply=2,  # Limit consecutive auto-replies
    code_execution_config=False
)
```

### 3. Cost-Based Limits

You can implement cost thresholds by monitoring usage:

```python
# Set a maximum cost limit (in USD)
MAX_COST = 0.50  

def check_cost_limit(agent):
    usage = agent.get_total_usage()
    if usage and usage["total_cost"] > MAX_COST:
        raise Exception(f"Cost limit of ${MAX_COST} exceeded. Current cost: ${usage['total_cost']:.2f}")

# Example usage in a conversation loop
try:
    for _ in range(max_turns):
        response = assistant.generate_response(message)
        check_cost_limit(assistant)
        # Process response...
except Exception as e:
    print(f"Conversation stopped: {e}")
```

## 1. Use AG2's OpenAIWrapper for cost estimation 

[Rest of the original content remains the same...]